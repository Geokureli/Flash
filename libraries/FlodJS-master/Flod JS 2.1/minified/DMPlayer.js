/*
  Flod JS 2.1
  2012/04/30
  Christian Corti
  Neoart Costa Rica

  Last Update: Flod JS 2.0 - 2012/03/13

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
  IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

  This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License.
  To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/ or send a letter to
  Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.
*/
(function(){function o(){return Object.create(null,{channel:{value:null,writable:!0},sample:{value:null,writable:!0},step:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},val1:{value:0,writable:!0},val2:{value:0,writable:!0},finalPeriod:{value:0,writable:!0},arpeggioStep:{value:0,writable:!0},effectCtr:{value:0,writable:!0},pitch:{value:0,writable:!0},pitchCtr:{value:0,writable:!0},pitchStep:{value:0,writable:!0},portamento:{value:0,writable:!0},volume:{value:0,writable:!0},
volumeCtr:{value:0,writable:!0},volumeStep:{value:0,writable:!0},mixMute:{value:0,writable:!0},mixPtr:{value:0,writable:!0},mixEnd:{value:0,writable:!0},mixSpeed:{value:0,writable:!0},mixStep:{value:0,writable:!0},mixVolume:{value:0,writable:!0},initialize:{value:function(){this.step=this.sample=null;this.volumeStep=this.volumeCtr=this.volume=this.portamento=this.pitchStep=this.pitchCtr=this.pitch=this.effectCtr=this.arpeggioStep=this.finalPeriod=this.val2=this.val1=this.period=this.note=0;this.mixMute=
1;this.mixVolume=this.mixStep=this.mixSpeed=this.mixEnd=this.mixPtr=0}}})}var p=[3220,3040,2869,2708,2556,2412,2277,2149,2029,1915,1807,1706,1610,1520,1434,1354,1278,1206,1139,1075,1014,957,904,853,805,760,717,677,639,603,569,537,507,479,452,426,403,380,359,338,319,302,285,269,254,239,226,213,201,190,179,169,160,151,142,134,127,4842,4571,4314,4072,3843,3628,3424,3232,3051,2879,2718,2565,2421,2285,2157,2036,1922,1814,1712,1616,1525,1440,1359,1283,1211,1143,1079,1018,961,907,856,808,763,720,679,641,
605,571,539,509,480,453,428,404,381,360,340,321,303,286,270,254,240,227,214,202,191,180,170,160,151,143,135,127,4860,4587,4330,4087,3857,3641,3437,3244,3062,2890,2728,2574,2430,2294,2165,2043,1929,1820,1718,1622,1531,1445,1364,1287,1215,1147,1082,1022,964,910,859,811,765,722,682,644,607,573,541,511,482,455,430,405,383,361,341,322,304,287,271,255,241,228,215,203,191,181,170,161,152,143,135,128,4878,4604,4345,4102,3871,3654,3449,3255,3073,2900,2737,2584,2439,2302,2173,2051,1936,1827,1724,1628,1536,
1450,1369,1292,1219,1151,1086,1025,968,914,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,4895,4620,4361,4116,3885,3667,3461,3267,3084,2911,2747,2593,2448,2310,2181,2058,1943,1834,1731,1634,1542,1455,1374,1297,1224,1155,1090,1029,971,917,865,817,771,728,687,648,612,578,545,515,486,458,433,408,385,364,343,324,306,289,273,257,243,229,216,204,193,182,172,162,153,144,136,129,4913,4637,4377,4131,3899,3681,3474,3279,
3095,2921,2757,2603,2456,2319,2188,2066,1950,1840,1737,1639,1547,1461,1379,1301,1228,1159,1094,1033,975,920,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,4931,4654,4393,4146,3913,3694,3486,3291,3106,2932,2767,2612,2465,2327,2196,2073,1957,1847,1743,1645,1553,1466,1384,1306,1233,1163,1098,1037,978,923,872,823,777,733,692,653,616,582,549,518,489,462,436,411,388,366,346,326,308,291,275,259,245,231,218,206,194,183,
173,163,154,145,137,130,4948,4671,4409,4161,3928,3707,3499,3303,3117,2942,2777,2621,2474,2335,2204,2081,1964,1854,1750,1651,1559,1471,1389,1311,1237,1168,1102,1040,982,927,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,4966,4688,4425,4176,3942,3721,3512,3315,3129,2953,2787,2631,2483,2344,2212,2088,1971,1860,1756,1657,1564,1477,1394,1315,1242,1172,1106,1044,985,930,878,829,782,738,697,658,621,586,553,522,493,465,
439,414,391,369,348,329,310,293,277,261,246,233,219,207,196,185,174,164,155,146,138,131,4984,4705,4441,4191,3956,3734,3524,3327,3140,2964,2797,2640,2492,2352,2220,2096,1978,1867,1762,1663,1570,1482,1399,1320,1246,1176,1110,1048,989,934,881,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,5002,4722,4457,4206,3970,3748,3537,3339,3151,2974,2807,2650,2501,2361,2228,2103,1985,1874,1769,1669,1576,1487,1404,1325,1251,1180,
1114,1052,993,937,884,835,788,744,702,662,625,590,557,526,496,468,442,417,394,372,351,331,313,295,279,263,248,234,221,209,197,186,175,166,156,148,139,131,5020,4739,4473,4222,3985,3761,3550,3351,3163,2985,2818,2659,2510,2369,2236,2111,1992,1881,1775,1675,1581,1493,1409,1330,1255,1185,1118,1055,996,940,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,5039,4756,4489,4237,3999,3775,3563,3363,3174,2996,2828,2669,2519,
2378,2244,2118,2E3,1887,1781,1681,1587,1498,1414,1335,1260,1189,1122,1059,1E3,944,891,841,794,749,707,667,630,594,561,530,500,472,445,420,397,374,353,334,315,297,281,265,250,236,223,210,198,187,177,167,157,149,140,132,5057,4773,4505,4252,4014,3788,3576,3375,3186,3007,2838,2679,2528,2387,2253,2126,2007,1894,1788,1688,1593,1503,1419,1339,1264,1193,1126,1063,1003,947,894,844,796,752,710,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,
5075,4790,4521,4268,4028,3802,3589,3387,3197,3018,2848,2688,2538,2395,2261,2134,2014,1901,1794,1694,1599,1509,1424,1344,1269,1198,1130,1067,1007,951,897,847,799,754,712,672,634,599,565,533,504,475,449,423,400,377,356,336,317,299,283,267,252,238,224,212,200,189,178,168,159,150,141,133,5093,4808,4538,4283,4043,3816,3602,3399,3209,3029,2859,2698,2547,2404,2269,2142,2021,1908,1801,1700,1604,1514,1429,1349,1273,1202,1134,1071,1011,954,900,850,802,757,715,675,637,601,567,535,505,477,450,425,401,379,357,
337,318,300,284,268,253,238,225,212,201,189,179,169,159,150,142,134];window.neoart.DMPlayer=function(n){n=AmigaPlayer(n);Object.defineProperties(n,{id:{value:"DMPlayer"},songs:{value:[],writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},voices:{value:[],writable:!0},buffer1:{value:0,writable:!0},buffer2:{value:0,writable:!0},song1:{value:0,writable:!0},song2:{value:0,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternLen:{value:0,writable:!0},
patternEnd:{value:0,writable:!0},stepEnd:{value:0,writable:!0},numChannels:{value:0,writable:!0},arpeggios:{value:null,writable:!0},averages:{value:null,writable:!0},volumes:{value:null,writable:!0},mixChannel:{value:null,writable:!0},mixPeriod:{value:0,writable:!0},initialize:{value:function(){var c,d=0,i;this.reset();7<this.playSong&&(this.playSong=0);this.song1=this.songs[this.playSong];this.speed=this.song1.speed&15;this.speed|=this.speed<<4;this.tick=this.song1.speed;this.patternPos=this.trackPos=
0;this.patternLen=64;this.stepEnd=this.patternEnd=1;for(this.numChannels=4;7>d;++d)i=this.voices[d],i.initialize(),i.sample=this.samples[0],4>d&&(c=this.mixer.channels[d],c.enabled=0,c.pointer=this.mixer.loopPtr,c.length=2,c.period=124,c.volume=0,i.channel=c);if(2==this.version){0!=(this.playSong&1)&&this.playSong--;this.song2=this.songs[this.playSong+1];this.mixChannel=AmigaChannel(7);this.numChannels=7;c=this.mixer.channels[3];c.mute=0;c.pointer=this.buffer1;c.length=350;c.period=this.mixPeriod;
c.volume=64;c=this.buffer1+700;for(d=this.buffer1;d<c;++d)this.mixer.memory[d]=0}}},loader:{value:function(c){var d,i=0,g,h,j,b;g=c.readString(24);if(" MUGICIAN/SOFTEYES 1990 "==g)this.version=1;else if(" MUGICIAN2/SOFTEYES 1990"==g)this.version=2;else return;c.position=28;for(h=new Uint32Array(8);8>i;++i)h[i]=c.readUint();c.position=76;for(i=0;8>i;++i)j=Object.create(null,{title:{value:"",writable:!0},speed:{value:0,writable:!0},length:{value:0,writable:!0},loop:{value:0,writable:!0},loopStep:{value:0,
writable:!0},tracks:{value:[],writable:!0}}),j.loop=c.readUbyte(),j.loopStep=c.readUbyte()<<2,j.speed=c.readUbyte(),j.length=c.readUbyte()<<2,j.title=c.readString(12),this.songs[i]=j;c.position=204;this.lastSong=this.songs.length-1;for(i=0;8>i;++i){j=this.songs[i];g=h[i]<<2;for(d=0;d<g;++d)b=AmigaStep(),b.pattern=c.readUbyte()<<6,b.transpose=c.readByte(),j.tracks[d]=b}j=c.position;c.position=60;g=c.readUint();this.samples.length=++g;c.position=j;for(i=1;i<g;++i)h=AmigaSample(),Object.defineProperties(h,
{wave:{value:0,writable:!0},waveLen:{value:0,writable:!0},finetune:{value:0,writable:!0},arpeggio:{value:0,writable:!0},pitch:{value:0,writable:!0},pitchDelay:{value:0,writable:!0},pitchLoop:{value:0,writable:!0},pitchSpeed:{value:0,writable:!0},effect:{value:0,writable:!0},effectDone:{value:0,writable:!0},effectStep:{value:0,writable:!0},effectSpeed:{value:0,writable:!0},source1:{value:0,writable:!0},source2:{value:0,writable:!0},volumeLoop:{value:0,writable:!0},volumeSpeed:{value:0,writable:!0}}),
b=Object.seal(h),b.wave=c.readUbyte(),b.waveLen=c.readUbyte()<<1,b.volume=c.readUbyte(),b.volumeSpeed=c.readUbyte(),b.arpeggio=c.readUbyte(),b.pitch=c.readUbyte(),b.effectStep=c.readUbyte(),b.pitchDelay=c.readUbyte(),b.finetune=c.readUbyte()<<6,b.pitchLoop=c.readUbyte(),b.pitchSpeed=c.readUbyte(),b.effect=c.readUbyte(),b.source1=c.readUbyte(),b.source2=c.readUbyte(),b.effectSpeed=c.readUbyte(),b.volumeLoop=c.readUbyte(),this.samples[i]=b;this.samples[0]=this.samples[1];j=c.position;c.position=64;
g=c.readUint()<<7;c.position=j;this.mixer.store(c,g);j=c.position;c.position=68;h=c.readUint();c.position=26;g=c.readUshort()<<6;this.patterns.length=g;c.position=j+(h<<5);h&&(h=j);for(i=0;i<g;++i)d=AmigaRow(),d.note=c.readUbyte(),d.sample=c.readUbyte()&63,d.effect=c.readUbyte(),d.param=c.readByte(),this.patterns[i]=d;j=c.position;c.position=72;if(h){g=c.readUint();c.position=j;d=this.mixer.store(c,g);j=c.position;this.mixer.memory.length+=350;this.buffer1=this.mixer.memory.length;this.mixer.memory.length+=
350;this.buffer2=this.mixer.memory.length;this.mixer.memory.length+=350;this.mixer.loopLen=8;g=this.samples.length;for(i=1;i<g;++i)if(b=this.samples[i],!(32>b.wave)&&(c.position=h+(b.wave-32<<5),b.pointer=c.readUint(),b.length=c.readUint()-b.pointer,b.loop=c.readUint(),b.name=c.readString(12),b.loop?(b.loop-=b.pointer,b.repeat=b.length-b.loop,0!=(b.repeat&1)&&b.repeat--):(b.loopPtr=this.mixer.memory.length,b.repeat=8),0!=(b.pointer&1)&&b.pointer--,0!=(b.length&1)&&b.length--,b.pointer+=d,!b.loopPtr))b.loopPtr=
b.pointer+b.loop}else j+=c.readUint();c.position=24;if(1==c.readUshort()){c.position=j;g=c.length-c.position;256<g&&(g=256);for(i=0;i<g;++i)this.arpeggios[i]=c.readUbyte()}}},process:{value:function(){for(var c,d,i=0,g,h,j,b=this.mixer.memory,l,k,m,f,e,a;i<this.numChannels;++i){a=this.voices[i];f=a.sample;if(3>i||4==this.numChannels){if(c=a.channel,this.stepEnd&&(a.step=this.song1.tracks[this.trackPos+i]),31<f.wave)c.pointer=f.loopPtr,c.length=f.repeat}else c=this.mixChannel,this.stepEnd&&(a.step=
this.song2.tracks[this.trackPos+(i-3)]);if(this.patternEnd&&(d=this.patterns[a.step.pattern+this.patternPos],d.note)){74!=d.effect&&(a.note=d.note,d.sample&&(f=a.sample=this.samples[d.sample]));a.val1=64>d.effect?1:d.effect-62;a.val2=d.param;g=a.step.transpose+f.finetune;12!=a.val1?(a.pitch=d.effect,1==a.val1&&(g+=a.pitch,a.period=0>g?0:p[g])):(a.pitch=d.note,g+=a.pitch,a.period=0>g?0:p[g]);11==a.val1&&(f.arpeggio=a.val2&7);if(12!=a.val1)if(31<f.wave)c.pointer=f.pointer,c.length=f.length,c.enabled=
0,a.mixPtr=f.pointer,a.mixEnd=f.pointer+f.length,a.mixMute=0;else if(d=f.wave<<7,c.pointer=d,c.length=f.waveLen,10!=a.val1&&(c.enabled=0),4==this.numChannels&&0!=f.effect&&2!=a.val1&&4!=a.val1){j=d+128;k=f.source1<<7;for(h=d;h<j;++h)b[h]=b[k++];f.effectStep=0;a.effectCtr=f.effectSpeed}3!=a.val1&&4!=a.val1&&12!=a.val1&&(a.volumeCtr=1,a.volumeStep=0);a.arpeggioStep=0;a.pitchCtr=f.pitchDelay;a.pitchStep=0;a.portamento=0}switch(a.val1){case 5:e=a.val2;0<e&&65>e&&(this.patternLen=e);break;case 6:e=a.val2&
15;e|=e<<4;if(0==a.val2||15<a.val2)break;this.speed=e;break;case 7:this.mixer.filter.active=1;break;case 8:this.mixer.filter.active=0;break;case 13:a.val1=0;e=a.val2&15;if(0==e)break;e=a.val2&240;if(0==e)break;this.speed=a.val2}}for(i=0;i<this.numChannels;++i){a=this.voices[i];f=a.sample;if(4==this.numChannels){if(c=a.channel,32>f.wave&&f.effect&&!f.effectDone)if(f.effectDone=1,a.effectCtr)a.effectCtr--;else switch(a.effectCtr=f.effectSpeed,d=f.wave<<7,f.effect){case 1:for(h=0;127>h;++h)e=b[d],e+=
b[d+1],b[d++]=e>>1;break;case 2:k=f.source1<<7;m=f.source2<<7;g=f.effectStep;j=f.waveLen;f.effectStep=++f.effectStep&127;for(h=0;h<j;++h)e=b[k++],e+=b[m+g],b[d++]=e>>1,g=++g&127;break;case 3:e=b[d];for(h=0;127>h;++h)b[d]=b[++d];b[d]=e;break;case 4:d+=127;e=b[d];for(h=0;127>h;++h)b[d]=b[--d];b[d]=e;break;case 5:g=e=d;for(h=0;64>h;++h)b[g++]=b[d++],d++;g=d=e;g+=64;for(h=0;64>h;++h)b[g++]=b[d++];break;case 6:k=d+64;d+=128;for(h=0;64>h;++h)b[--d]=b[--k],b[--d]=b[k];break;case 7:d+=f.effectStep;b[d]=~b[d]+
1;++f.effectStep>=f.waveLen&&(f.effectStep=0);break;case 8:f.effectStep=++f.effectStep&127;m=(f.source2<<7)+f.effectStep;g=b[m];j=f.waveLen;e=3;for(h=0;h<j;++h)k=b[d]+e,-128>k?k+=256:127<k&&(k-=256),b[d++]=k,e+=g,-128>e?e+=256:127<e&&(e-=256);break;case 9:m=f.source2<<7;j=f.waveLen;for(h=0;h<j;++h)e=b[m++],e+=b[d],127<e&&(e-=256),b[d++]=e;break;case 10:for(h=0;126>h;++h)e=3*b[d++],e+=b[d+1],b[d]=e>>2;break;case 11:k=f.source1<<7;m=f.source2<<7;j=f.waveLen;f.effectStep=++f.effectStep&127;e=f.effectStep;
64<=e&&(e=127-e);g=(e^255)&63;for(h=0;h<j;++h)l=b[k++]*e,l+=b[m++]*g,b[d++]=l>>6;break;case 12:k=f.source1<<7;m=f.source2<<7;j=f.waveLen;f.effectStep=++f.effectStep&31;e=f.effectStep;16<=e&&(e=31-e);g=(e^255)&15;for(h=0;h<j;++h)l=b[k++]*e,l+=b[m++]*g,b[d++]=l>>4;break;case 13:for(h=0;126>h;++h)e=b[d++],e+=b[d+1],b[d]=e>>1;break;case 14:g=d+f.effectStep;b[g]=~b[g]+1;g=f.effectStep+f.source2&f.waveLen-1;g+=d;b[g]=~b[g]+1;++f.effectStep>=f.waveLen&&(f.effectStep=0);break;case 15:g=d;for(h=0;127>h;++h)e=
b[d],e+=b[d+1],b[d++]=e>>1;d=g;f.effectStep++;if(f.effectStep==f.source2){f.effectStep=0;g=e=d;for(h=0;64>h;++h)b[g++]=b[d++],d++;g=d=e;g+=64;for(h=0;64>h;++h)b[g++]=b[d++]}}}else c=3>i?a.channel:this.mixChannel;a.volumeCtr&&(a.volumeCtr--,0==a.volumeCtr&&(a.volumeCtr=f.volumeSpeed,a.volumeStep=++a.volumeStep&127,a.volumeStep||f.volumeLoop?(g=a.volumeStep+(f.volume<<7),e=~(b[g]+129)+1,a.volume=(e&255)>>2,c.volume=a.volume):a.volumeCtr=0));e=a.note;f.arpeggio&&(g=a.arpeggioStep+(f.arpeggio<<5),e+=
this.arpeggios[g],a.arpeggioStep=++a.arpeggioStep&31);g=e+a.step.transpose+f.finetune;a.finalPeriod=p[g];d=a.finalPeriod;if(1==a.val1||12==a.val1)if(e=~a.val2+1,a.portamento+=e,a.finalPeriod+=a.portamento,a.val2&&(0>e&&a.finalPeriod<=a.period||0<=e&&a.finalPeriod>=a.period))a.portamento=a.period-d,a.val2=0;f.pitch&&(a.pitchCtr?a.pitchCtr--:(g=a.pitchStep,a.pitchStep=++a.pitchStep&127,0==a.pitchStep&&(a.pitchStep=f.pitchLoop),g+=f.pitch<<7,e=b[g],a.finalPeriod+=~e+1));c.period=a.finalPeriod}if(4<this.numChannels){k=
this.buffer1;this.buffer1=this.buffer2;this.buffer2=k;c=this.mixer.channels[3];c.pointer=k;for(i=3;7>i;++i)a=this.voices[i],a.mixStep=0,125>a.finalPeriod?(a.mixMute=1,a.mixSpeed=0):(h=(a.finalPeriod<<8)/this.mixPeriod&65535,m=(256/h&255)<<8,d=256%h<<8&16777215,a.mixSpeed=(m|d/h&255)<<8),a.mixVolume=a.mixMute?0:a.volume<<8;for(i=0;350>i;++i){d=0;for(h=3;7>h;++h)a=this.voices[h],m=(b[a.mixPtr+(a.mixStep>>16)]&255)+a.mixVolume,d+=this.volumes[m],a.mixStep+=a.mixSpeed;b[k++]=this.averages[d]}c.length=
350;c.period=this.mixPeriod;c.volume=64}if(0==--this.tick){if(this.tick=this.speed&15,this.speed=(this.speed&240)>>4,this.speed|=this.tick<<4,this.patternEnd=1,this.patternPos++,64==this.patternPos||this.patternPos==this.patternLen)this.patternPos=0,this.stepEnd=1,this.trackPos+=4,this.trackPos==this.song1.length&&(this.trackPos=this.song1.loopStep,this.mixer.complete=1)}else this.stepEnd=this.patternEnd=0;for(i=0;i<this.numChannels;++i)if(a=this.voices[i],a.mixPtr+=a.mixStep>>16,f=a.sample,f.effectDone=
0,a.mixPtr>=a.mixEnd&&(f.loop?a.mixPtr-=f.repeat:(a.mixPtr=0,a.mixMute=1)),4>i)c=a.channel,c.enabled=1}},tables:{value:function(){var c=0,d,i,g=0,h=0,j,b,l=128;this.averages=new Int32Array(1024);this.volumes=new Int32Array(16384);for(this.mixPeriod=203;1024>c;++c)127<l&&(l-=256),this.averages[c]=l,383<c&&639>c&&(l=++l&255);for(c=0;64>c;++c){j=-128;b=128;for(i=0;256>i;++i)l=j*h/63+128,d=g+b,this.volumes[d]=l&255,0!=c&&63!=c&&128<=b&&--this.volumes[d],j++,b=++b&255;g+=256;h++}}}});n.voices[0]=o();n.voices[1]=
o();n.voices[2]=o();n.voices[3]=o();n.voices[4]=o();n.voices[5]=o();n.voices[6]=o();n.arpeggios=new Uint8Array(256);n.tables();return Object.seal(n)}})();